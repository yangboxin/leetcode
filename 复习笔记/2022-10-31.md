### lc-481

神奇字符串 `s` 仅由 `'1'` 和 `'2'` 组成，并需要遵守下面的规则：

- 神奇字符串 s 的神奇之处在于，串联字符串中 `'1'` 和 `'2'` 的连续出现次数可以生成该字符串。

`s` 的前几个元素是 `s = "1221121221221121122……"` 。如果将 `s` 中连续的若干 `1` 和 `2` 进行分组，可以得到 `"1 22 11 2 1 22 1 22 11 2 11 22 ......"` 。每组中 `1` 或者 `2` 的出现次数分别是 `"1 2 2 1 1 2 1 2 2 1 2 2 ......"` 。上面的出现次数正是 `s` 自身。

给你一个整数 `n` ，返回在神奇字符串 `s` 的前 `n` 个数字中 `1` 的数目。



##### 预处理前缀和

 由于1和2交替分组出现，并且在神奇字符串中每组都一定是不大于2的数，所以每组最大有两个数，我们用一个指针指向神奇字符串中的每一个数字a，并在末尾加入a个数b；而数b又取决于当前神奇字符串末尾的数，由于1、2交替出现，故b应该取末尾的数^3的数（1->2,2->1）.

同时计算当前有多少个1并放入前缀和数组。

```c++
const int MX = 1e5;
int acc[MX + 1];

int init = []() {
    string s = "\1\2\2";
    for (int i = 2; s.length() < MX; ++i)
        s += string(s[i], s.back() ^ 3); // 1^3=2, 2^3=1，这样就能在 1 和 2 之间转换
    for (int i = 0; i < MX; ++i)
        acc[i + 1] = acc[i] + 2 - s[i]; // 2-1=1，2-2=0，这样就只统计了 1
    return 0;
}();

class Solution {
public:
    int magicalString(int n) {
        return acc[n];
    }
};

```

